services:
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=0
      - PGID=0
      - TZ=Europe/Zurich
      - WEBUI_PORT=8080
    volumes:
      - ./qbittorrent:/config
      - /volume2/EmblyFiles:/downloads
    ports:
      - "8080:8080"
    restart: unless-stopped

  magnet-api:
    image: python:3.12-slim
    container_name: magnet-api
    working_dir: /app
    volumes:
      - ./app:/app:ro
      - /volume2/EmblyFiles:/downloads
    environment:
      - API_TOKEN=a9F3kL2M0s8xQeVbC7D5PZJYwE6R4t1U
      - DOWNLOADS_ROOT=/downloads
      - QB_URL=http://qbittorrent:8080
      - QB_USER=admin
      - QB_PASS=xjvs3esbQ1g4YJPsRE29
    command: >
      sh -c "pip install --no-cache-dir -r requirements.txt
      && uvicorn main:app --host 0.0.0.0 --port 5000"
    ports:
      - "5050:5000"
    depends_on:
      - qbittorrent
    restart: unless-stopped